<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="referrer" content="no-referrer">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Traductions</title>

  <link rel="icon" href="./favicon.png" />
  <link rel="stylesheet" href="./viewer.css" />
</head>
<body>

  <!-- =======================================================
       VIEWER (page principale)
       ======================================================= -->
  <div id="viewerPage">
    <!-- Nouvelle interface (visuel) : shell + sidebar + header compact.
         âœ… On garde les mÃªmes IDs/Ã©lÃ©ments pour que viewer.js continue de fonctionner. -->
    <div class="viewer-shell">
      <aside class="viewer-side" aria-label="Filtres">
        <div class="side-brand">
          <div class="brand-title">Traductions</div>
          <!-- (le menu â˜° est injectÃ© par viewer.js dans .top-title-row ;
               on garde aussi un emplacement visuel ici via CSS) -->
          <div class="brand-sub">Recherche Â· Filtres Â· Tags</div>
        </div>

        <div class="side-group">
          <div class="side-label">CatÃ©gorie</div>
          <select id="filterCat" title="CatÃ©gorie">
            <option value="all">Toutes</option>
            <option value="VN">VN</option>
            <option value="Collection">Collection</option>
          </select>
        </div>

        <div class="side-group">
          <div class="side-label">Moteur</div>
          <select id="filterEngine" title="Moteur">
            <option value="all">Tous</option>
            <option value="Ren'Py">Ren'Py</option>
            <option value="RPGM">RPGM</option>
            <option value="Unity">Unity</option>
            <option value="Unreal Engine">Unreal Engine</option>
            <option value="HTML">HTML</option>
            <option value="Java">Java</option>
            <option value="Flash">Flash</option>
            <option value="QSP">QSP</option>
            <option value="WebGL">WebGL</option>
            <option value="RAGS">RAGS</option>
            <option value="Tads">Tads</option>
            <option value="ADRIFT">ADRIFT</option>
            <option value="Others">Others</option>
            <option value="Wolf RPG">Wolf RPG</option>
          </select>
        </div>

        <div class="side-group">
          <div class="side-label">Statut</div>
          <select id="filterStatus" title="Statut">
            <option value="all">Tous</option>
            <option value="En cours">En cours</option>
            <option value="Completed">Completed</option>
            <option value="Abandoned">Abandoned</option>
            <option value="Onhold">Onhold</option>
          </select>
        </div>

        <div class="side-row">
          <div class="side-group">
            <div class="side-label">Colonnes</div>
            <select id="cols" title="Colonnes">
              <option value="auto">Auto</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
            </select>
          </div>

          <div class="side-group">
            <div class="side-label">Page</div>
            <select id="pageSize" title="Pagination">
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="all">Tout</option>
            </select>
          </div>
        </div>

        <div class="side-group">
          <div class="side-label">Tri</div>
          <select id="sort" title="Trier">
            <option value="updatedAtLocal-desc">Maj (local) â†“</option>
            <option value="updatedAtLocal-asc">Maj (local) â†‘</option>
            <option value="updatedAt-desc">Maj â†“</option>
            <option value="updatedAt-asc">Maj â†‘</option>
            <option value="releaseDate-desc">Sortie â†“</option>
            <option value="releaseDate-asc">Sortie â†‘</option>
            <option value="title-asc">Titre Aâ†’Z</option>
            <option value="title-desc">Titre Zâ†’A</option>
            <option value="views-desc">Vues â†“</option>
            <option value="views-asc">Vues â†‘</option>
            <option value="mega-desc">TÃ©lÃ©chargements â†“</option>
            <option value="mega-asc">TÃ©lÃ©chargements â†‘</option>
            <option value="likes-desc">Jâ€™aime â†“</option>
            <option value="likes-asc">Jâ€™aime â†‘</option>
          </select>
        </div>

        <div class="side-footer">
          <div class="side-metrics">
            <div class="metric"><span>Total</span> <strong id="countTotal">0</strong></div>
            <div class="metric"><span>Vues page</span> <strong id="mainViews">0</strong></div>
          </div>
          <button id="refresh" class="btn" type="button" title="RafraÃ®chir">ğŸ”„ RafraÃ®chir</button>
        </div>
      </aside>

      <section class="viewer-main">
        <header class="viewer-top" role="banner">
          <div class="top-title-row top-title-flex">
            <h1>Traductions</h1>
            <!-- (le menu â˜° est injectÃ© par viewer.js) -->
            <div class="top-title-tools">
              <button id="sideToggle" class="side-toggle" type="button" title="Masquer/afficher la barre de gauche" aria-pressed="false">
                <span class="side-toggle-ico" aria-hidden="true">â«·</span>
              </button>
            </div>
          </div>

          <!-- âœ… On garde .top-actions car viewer.js s'en sert pour insÃ©rer le bouton Tags si besoin -->
          <div class="top-actions">
            <div class="search-wrap">
              <input id="search" type="search" placeholder="Rechercher (titre, tagsâ€¦)" autocomplete="off" />
              <span class="stat-in-bar total-inline">RÃ©sultats : <strong id="countFound">0</strong></span>
            </div>
            <!-- place pour tagsBtn injectÃ© automatiquement -->
          </div>
        </header>

        <main class="wrap">
          <section id="grid" class="grid"></section>
          <div id="gridEmpty" class="grid-empty hidden">Aucun rÃ©sultat</div>
        </main>
      </section>
    </div>

  </div>

  <!-- =======================================================
       GAME (page jeu) â€” mÃªme URL, bascule via ?id / ?uid
       ======================================================= -->
  <div id="gamePage" style="display:none">
    <!-- Nouvelle interface (visuel) : page jeu en 2 colonnes + actions sticky.
         âœ… IDs conservÃ©s pour game.js. -->
    <div class="game-shell">
      <header class="game-top">
        <button id="hamburgerBtn" class="hamburger-btn" aria-label="Ouvrir le menu" aria-haspopup="menu" aria-expanded="false">
          <span class="ham-lines" aria-hidden="true"><span></span><span></span><span></span></span>
        </button>
        <div class="game-top-title">Traductions</div>
        <div class="game-top-spacer"></div>
      </header>

      <div id="topMenuPopover" class="hidden"></div>
      <div id="errBox"></div>

      <div id="card" class="game-layout">
        <!-- Colonne gauche : cover + infos + actions -->
        <aside class="game-aside">
          <div class="game-cover-wrap">
            <img id="cover" class="is-placeholder" alt="">
          </div>

          <div class="game-head">
            <h2 id="title">â€”</h2>
            <div id="badges"></div>
            <div id="tags"></div>
          </div>

          <div class="game-actions">
            <div class="btnMainRow">
              <a id="btnDiscord" class="btn btn-discord" target="_blank" rel="noopener" href="#">ğŸ’¬ Discord</a>
              <a id="btnF95" class="btn btn-f95" target="_blank" rel="noopener" href="#"><span class="f95-white"> F95</span><span class="f95-red">Zone</span></a>
            </div>

            <div class="btnRow">
              <a id="btnMega" class="btn" target="_blank" rel="noopener" href="#">ğŸ“¥ TÃ©lÃ©charger la traduction (MEGA)</a>
              <div class="likeWrap">
                <button id="btnLike" type="button" aria-label="Jâ€™aime">ğŸ¤</button>
              </div>
            </div>

            <div id="archiveBox" class="archiveRow" style="display:none;">
              <a id="archiveLink" class="btn" target="_blank" rel="noopener" href="#">ğŸ“¦ Archives de la traduction</a>
            </div>
          </div>
        </aside>

        <!-- Colonne droite : contenu -->
        <main class="game-content">
          <section id="descriptionBox" class="game-panel" style="display:none;">
            <h3>ğŸ“œ Description</h3>
            <div id="descriptionText" class="game-text"></div>
          </section>

          <section id="statsOut" class="game-panel">
            <h3>ğŸ“Š Statistiques</h3>
            <div class="statsLine">
              <span>ğŸ‘ï¸ Vues : <strong id="statViews" class="statNum">0</strong></span>
              <span>ğŸ“¥ TÃ©lÃ©chargements : <strong id="statMegaClicks" class="statNum">0</strong></span>
              <span>â¤ï¸ Jâ€™aime : <strong id="statLikes" class="statNum">0</strong></span>
            </div>
          </section>

          <section id="notesBox" class="game-panel" style="display:none;">
            <h3>ğŸ“ Notes</h3>
            <div id="notesText" class="game-text"></div>
          </section>

          <section id="ratingBox" class="game-panel">
            <h3>â­ Note de la traduction</h3>
            <div class="ratingRow">
              <div>
                Moyenne : <strong id="ratingAvg">â€”</strong> Â· Votes : <strong id="ratingCount">0</strong>
              </div>
              <div id="ratingChoices" class="ratingChoices"></div>
            </div>
            <div id="ratingMsg" class="ratingMsg"></div>
          </section>
        </main>
      </div>
    </div>
  </div>

  <!-- =======================================================
       Bascule Viewer/Game + scripts
       ======================================================= -->
  <script>
    (function() {
      const p = new URLSearchParams(location.search);
      const hasGame = !!(p.get("id") || p.get("uid"));
      const vp = document.getElementById("viewerPage");
      const gp = document.getElementById("gamePage");
      if (vp) vp.style.display = hasGame ? "none" : "";
      if (gp) gp.style.display = hasGame ? "" : "none";
      document.body.classList.toggle("page-game", hasGame);
    })();
  </script>

  <!-- Scripts communs -->
  <script src="./viewer.annonce.js"></script>
  <script src="./viewer.menu.js"></script>
  <script src="./viewer.menu.about.js"></script>
  <script src="./viewer.menu.extension.js"></script>

  <!-- Viewer / Game -->
  <script src="./viewer.js"></script>
  <script src="./game.js"></script>
</body>
</html>
